<ion-header>
    <ion-toolbar style="--background: var(--ion-color-toolbar-primary); color: var(--ion-title-color);">
        <ion-title>{{ COMPONENT.ALIAS }}</ion-title>
        <ion-buttons slot="end">
            <oe-help-button key="CONTROLLER_CHP_SOC"></oe-help-button>
            <ion-button (click)="MODAL_CTRL.DISMISS()">
                <ion-icon name="close-outline" style="color: var(--ion-title-color);"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ng-container *ngIf="EDGE.CURRENT_DATA | async as currentData">
        <ion-card-content class="underline">
            <table class="full_width">
                <tr>
                    <td translate>
                        GENERAL.MODE
                    </td>
                </tr>
            </table>
            <!-- ngIf prevents ionChange to trigger on init -->
            <ion-segment *ngIf="component" (ionChange)="updateMode($event)" value="{{ COMPONENT.PROPERTIES['mode'] }}"
                scrollable="false">
                <ion-segment-button value="MANUAL_ON">
                    <ion-label translate>
                        GENERAL.ON
                    </ion-label>
                    <ion-icon [color]="COMPONENT.PROPERTIES['mode'] === 'MANUAL_ON' ? 'success' : 'normal'"
                        style="width:40px" name="power-outline"></ion-icon>
                </ion-segment-button>
                <ion-segment-button value="AUTOMATIC">
                    <ion-label translate>
                        GENERAL.AUTOMATIC
                    </ion-label>
                    <ion-icon style="width:40px" name="sunny-outline"
                        [color]="COMPONENT.PROPERTIES['mode'] === 'AUTOMATIC' ? 'primary' : 'normal'">
                    </ion-icon>
                </ion-segment-button>
                <ion-segment-button value="MANUAL_OFF">
                    <ion-label translate>
                        GENERAL.OFF
                    </ion-label>
                    <ion-icon name="power-outline" style="width: 40px"
                        [color]="COMPONENT.PROPERTIES['mode'] === 'MANUAL_OFF' ? 'danger' : 'normal'"></ion-icon>
                </ion-segment-button>
            </ion-segment>
        </ion-card-content>
        <ng-container *ngIf="COMPONENT.PROPERTIES['mode'] === 'AUTOMATIC' && EDGE.ROLE_IS_AT_LEAST('owner')">
            <ion-card-content class="underline">
                <table class="full_width">
                    <tr>
                        <td style="width: 65%" translate>
                            GENERAL.SOC
                        </td>
                        <td style="width: 35%" class="align_right">
                            {{ CURRENT_DATA.CHANNEL[inputChannel] | unitvalue:'%' }}
                        </td>
                    </tr>
                    <div style="padding-top: 5px;"></div>
                    <tr>
                        <td style="width: 65%" translate>
                            EDGE.INDEX.WIDGETS.CHP.HIGH_THRESHOLD
                        </td>
                        <td style="width: 35%" class="align_right">
                            {{ COMPONENT.PROPERTIES['highThreshold'] | unitvalue:'%' }}
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 65%" translate>
                            EDGE.INDEX.WIDGETS.CHP.LOW_THRESHOLD
                        </td>
                        <td style="width: 35%" class="align_right">
                            {{ COMPONENT.PROPERTIES['lowThreshold'] | unitvalue:'%' }}
                        </td>
                    </tr>
                </table>
                <table class="full_width">
                    <tr>
                        <ion-range (ionChange)="updateThresholds()" dual-knobs pin color="dark" min="0" max="100"
                            [(ngModel)]="thresholds" debounce="500">
                            <ion-label slot="start">
                                {{ 0 | unitvalue:'%' }}
                            </ion-label>
                            <ion-label slot="end">
                                {{ 100 | unitvalue:'%' }}
                            </ion-label>
                        </ion-range>
                    </tr>
                </table>
            </ion-card-content>
        </ng-container>
        <ion-card-content>
            <table class="full_width">
                <tr>
                    <td style="width:65%" translate>GENERAL.STATE</td>
                    <td style="width:35%" class="align_right">
                        <ng-container [ngSwitch]="CURRENT_DATA.CHANNEL[outputChannel]">
                            <span *ngSwitchCase="1" translate>GENERAL.ACTIVE</span>
                            <span *ngSwitchCase="0" translate>GENERAL.INACTIVE</span>
                            <ion-icon *ngSwitchDefault name="help-outline"></ion-icon>
                        </ng-container>
                    </td>
                </tr>
            </table>
        </ion-card-content>
    </ng-container>
</ion-content>
