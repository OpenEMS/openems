<oe-refresh-view [refresh]="handleRefresh" [show]="showRefreshDragDown">
  <ion-refresher mode="ios" slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content refreshingSpinner="crescent"></ion-refresher-content>
  </ion-refresher>
  <ion-grid *ngIf="edge && edge.isOnline">
    <ion-row class="ion-justify-content-center ion-no-padding" *ngIf="widgets">

      <!-- Left column -->
      <ion-col size="12" [attr.size-md]="navigationService.position === 'left' ? 8 : 8"
        [attr.size-lg]="navigationService.position === 'left' ? 4 : 3" class="ion-no-padding">
        <ion-grid class="ion-no-padding">
          <ion-row>
            <ion-col size="12">
              <ng-container *ngFor="let clazz of widgets.classes" [ngSwitch]="clazz">
                <!-- Energymonitor -->
                <energymonitor *ngSwitchCase="'Energymonitor'"></energymonitor>
              </ng-container>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-col>

      <!-- Widgets -->
      <ion-col size="12" size-md="8" size-lg="6" class="ion-no-padding">
        <ngx-masonry [options]="masonryOptions" [updateLayout]="updateMasonryLayout" class="masonry-grid">
          <div class="ion-no-padding masonry-sizer"></div>

          <!-- Regular Widgets -->
          <ng-container *ngFor="let clazz of widgets.classes" [ngSwitch]="clazz">

            <div *ngSwitchCase="'Common_Autarchy'" class="ion-no-padding masonry-item">
              <Common_Autarchy></Common_Autarchy>
            </div>

            <div *ngSwitchCase="'Common_Selfconsumption'" class="ion-no-padding masonry-item">
              <Common_Selfconsumption></Common_Selfconsumption>
            </div>

            <div *ngSwitchCase="'Storage'" class="ion-no-padding masonry-item">
              <storage></storage>
            </div>

            <div *ngSwitchCase="'Grid'" class="ion-no-padding masonry-item">
              <grid></grid>
            </div>

            <div *ngSwitchCase="'Common_Production'" class="ion-no-padding masonry-item">
              <Common_Production></Common_Production>
            </div>

            <div *ngSwitchCase="'Consumption'" class="ion-no-padding masonry-item">
              <consumption></consumption>
            </div>

          </ng-container>

          <!-- Widgets depending on the configuration of the OpenEMS Edge -->
          <ng-container *ngFor="let widget of widgets.list" [ngSwitch]="widget.name">

            <!-- Widgets that are likely to be configured frequently -->

            <ng-container *ngIf="config.components[widget.componentId].factoryId as factoryId">
              <ng-container
                *ngIf="factoryId !== 'Evcs.Cluster.PeakShaving' && factoryId !== 'Evcs.Cluster.SelfConsumption'">
                <div *ngSwitchCase="'io.openems.edge.evcs.api.Evcs'" class="ion-no-padding masonry-item">
                  <Controller_Evcs [componentId]="widget.componentId"></Controller_Evcs>
                </div>
              </ng-container>
            </ng-container>

            <div *ngSwitchCase="'Evcs.Cluster.SelfConsumption'" class="ion-no-padding masonry-item">
              <Evcs_Api_Cluster [componentId]="widget.componentId"></Evcs_Api_Cluster>
            </div>

            <div *ngSwitchCase="'Evcs.Cluster.PeakShaving'" class="ion-no-padding masonry-item">
              <Evcs_Api_Cluster [componentId]="widget.componentId"></Evcs_Api_Cluster>
            </div>

            <div *ngSwitchCase="'Controller.ChannelThreshold'" class="ion-no-padding masonry-item">
              <Controller_Channelthreshold [componentId]="widget.componentId">
              </Controller_Channelthreshold>
            </div>

            <div *ngSwitchCase="'io.openems.impl.controller.channelthreshold.ChannelThresholdController'"
              class="ion-no-padding masonry-item">
              <Controller_Channelthreshold [componentId]="widget.componentId">
              </Controller_Channelthreshold>
            </div>

            <div *ngSwitchCase="'Controller.Io.FixDigitalOutput'" class="ion-no-padding masonry-item">
              <Controller_Io_FixDigitalOutput [componentId]="widget.componentId">
              </Controller_Io_FixDigitalOutput>
            </div>

            <ng-container *ngIf="isModbusTcpWidgetAllowed">
              <div *ngSwitchCase="'Controller.Api.ModbusTcp.ReadWrite'" class="ion-no-padding masonry-item">
                <Controller_Api_ModbusTcp [componentId]="widget.componentId"></Controller_Api_ModbusTcp>
              </div>
            </ng-container>

            <!-- Widgets that are likely to be configured seldomly -->

            <div *ngSwitchCase="'Controller.CHP.SoC'" class="ion-no-padding masonry-item">
              <Controller_ChpSocComponent [componentId]="widget.componentId"></Controller_ChpSocComponent>
            </div>

            <div *ngSwitchCase="'Controller.IO.HeatingElement'" class="ion-no-padding masonry-item">
              <Controller_Io_HeatingElement [componentId]="widget.componentId">
              </Controller_Io_HeatingElement>
            </div>

            <div *ngSwitchCase="'Controller.Io.HeatPump.SgReady'" class="ion-no-padding masonry-item">
              <Controller_Io_Heatpump [componentId]="widget.componentId"></Controller_Io_Heatpump>
            </div>

            <div *ngSwitchCase="'Controller.Symmetric.PeakShaving'" class="ion-no-padding masonry-item">
              <Controller_Symmetric_PeakShaving [componentId]="widget.componentId">
              </Controller_Symmetric_PeakShaving>
            </div>

            <div *ngSwitchCase="'Controller.Asymmetric.PeakShaving'" class="ion-no-padding masonry-item">
              <Controller_Asymmetric_PeakShaving [componentId]="widget.componentId">
              </Controller_Asymmetric_PeakShaving>
            </div>

            <div *ngSwitchCase="'Controller.TimeslotPeakshaving'" class="ion-no-padding masonry-item">
              <Controller_Symmetric_TimeSlot_PeakShaving [componentId]="widget.componentId">
              </Controller_Symmetric_TimeSlot_PeakShaving>
            </div>

            <div *ngSwitchCase="'Controller.Ess.DelayedSellToGrid'" class="ion-no-padding masonry-item">
              <delayedselltogrid [componentId]="widget.componentId"></delayedselltogrid>
            </div>

            <div *ngSwitchCase="'Controller.IO.ChannelSingleThreshold'" class="ion-no-padding masonry-item">
              <Controller_Io_ChannelSingleThresholdComponent [componentId]="widget.componentId">
              </Controller_Io_ChannelSingleThresholdComponent>
            </div>

            <div *ngSwitchCase="'Controller.Ess.Time-Of-Use-Tariff'" class="ion-no-padding masonry-item">
              <Controller_Ess_TimeOfUseTariff [componentId]="widget.componentId">
              </Controller_Ess_TimeOfUseTariff>
            </div>

            <div *ngSwitchCase="'io.openems.edge.io.api.DigitalInput'" class="ion-no-padding masonry-item">
              <Io_Api_DigitalInput></Io_Api_DigitalInput>
            </div>

            <div *ngSwitchCase="'Controller.Ess.FixActivePower'" class="ion-no-padding masonry-item">
              <Controller_Ess_FixActivePower [componentId]="widget.componentId">
              </Controller_Ess_FixActivePower>
            </div>

            <div *ngSwitchCase="'Controller.Ess.GridOptimizedCharge'" class="ion-no-padding masonry-item">
              <Controller_Ess_GridOptimizedCharge [componentId]="widget.componentId">
              </Controller_Ess_GridOptimizedCharge>
            </div>
          </ng-container>
        </ngx-masonry>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid *ngIf="edge && edge.isOnline && !edge.subscribeChannelsSuccessful">
    <ion-progress-bar type="indeterminate"></ion-progress-bar>
  </ion-grid>

  <ion-grid *ngIf="edge && !edge.isOnline">
    <ion-row class="ion-justify-content-center">
      <ion-col size-xl="8" size-lg="10" size-md="11" size-sm="12">
        <oe-offline></oe-offline>
      </ion-col>
    </ion-row>
  </ion-grid>
</oe-refresh-view>
