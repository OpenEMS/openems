<ng-template #type let-value="value" let-indentation="indentation">
  @switch (VALUE.TYPE) {
    @case ("object") {
      &#123;
      <br />
      <a *ngFor="let item of VALUE.PROPERTIES | keyvalue">
        <a *ngFor="let i of [].constructor(indentation)"> &nbsp; </a>
        "{{ ITEM.KEY }}":
        <template
          [ngTemplateOutlet]="type"
          [ngTemplateOutletContext]="{
            value: ITEM.VALUE,
            indentation: indentation + 4,
          }"
        ></template
        >,
        <br />
      </a>
      <a *ngFor="let i of [].constructor(indentation - 4)"> &nbsp; </a>
      &#125;
    }
    @case ("string" || "number" || "boolean" || "primitive" || "element") {
      {{ VALUE.TYPE }}
    }
    @case ("array") {
      <template
        *ngIf="VALUE.ELEMENT_TYPE"
        [ngTemplateOutlet]="type"
        [ngTemplateOutletContext]="{
          value: VALUE.ELEMENT_TYPE,
          indentation: indentation + 4,
        }"
      ></template>
      []
    }
    @case ("multiple") {
      <a *ngFor="let i of VALUE.VALID_TYPES">
        <template
          [ngTemplateOutlet]="type"
          [ngTemplateOutletContext]="{ value: i, indentation: indentation + 4 }"
        ></template>
        |
      </a>
    }
  }
  @if (VALUE.OPTIONAL) {
    ?
  }
</ng-template>

<ion-content>
  <ion-grid>
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-xl="8">
        <ng-container *ngFor="let endpoint of endpoints">
          <!-- <ion-card lines="none"> -->
          <ion-accordion-group>
            <ion-accordion>
              <ion-item slot="header" lines="bottom">
                <ion-label style="white-space: initial">
                  <span
                    *ngFor="let parent of ENDPOINT.PARENT"
                    style="opacity: 30%"
                  >
                    {{ PARENT.METHOD }} âž”
                  </span>
                  {{ ENDPOINT.METHOD }}
                  <a *ngFor="let tag of ENDPOINT.TAGS">
                    <ion-chip> {{ TAG.NAME }} </ion-chip>
                  </a>
                </ion-label>
              </ion-item>
              <ion-card-content slot="content">
                <ion-grid>
                  <ion-row>
                    <ion-col size="12" *ngIf="ENDPOINT.DESCRIPTION">
                      <div [innerHTML]="ENDPOINT.DESCRIPTION"></div>
                    </ion-col>
                  </ion-row>
                  <ion-row *ngFor="let guard of ENDPOINT.GUARDS">
                    <ion-col size="12">
                      <ion-chip> {{ GUARD.NAME }} </ion-chip>
                      {{ GUARD.DESCRIPTION }}
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="6" *ngIf="ENDPOINT.REQUEST.JSON">
                      <div>Request</div>
                      <template
                        [ngTemplateOutlet]="type"
                        [ngTemplateOutletContext]="{
                          value: ENDPOINT.REQUEST.JSON,
                          indentation: 4,
                        }"
                      ></template>
                      <!-- <pre><code>{{ENDPOINT.REQUEST}}</code></pre> -->
                    </ion-col>
                    <ion-col size="6" *ngIf="ENDPOINT.RESPONSE.JSON">
                      <div>Response</div>
                      <template
                        [ngTemplateOutlet]="type"
                        [ngTemplateOutletContext]="{
                          value: ENDPOINT.RESPONSE.JSON,
                          indentation: 4,
                        }"
                      ></template>
                    </ion-col>
                  </ion-row>
                  <ion-row
                    *ngIf="
                      ENDPOINT.REQUEST.EXAMPLES && ENDPOINT.RESPONSE.EXAMPLES
                    "
                  >
                    <ion-col size="12"> Examples </ion-col>
                    <ion-col size="6" *ngIf="ENDPOINT.REQUEST.JSON">
                      <ion-item>
                        <ion-select
                          label="Example Request"
                          placeholder="Select example Request..."
                          [(ngModel)]="ENDPOINT.REQUEST.SELECTED_EXAMPLE"
                          interface="popover"
                        >
                          <ion-select-option
                            *ngFor="let example of ENDPOINT.REQUEST.EXAMPLES"
                            [value]="EXAMPLE.KEY"
                          >
                            {{ EXAMPLE.KEY }}
                          </ion-select-option>
                        </ion-select>
                      </ion-item>
                      <div *ngFor="let example of ENDPOINT.REQUEST.EXAMPLES">
                        <div
                          *ngIf="
                            EXAMPLE.KEY === ENDPOINT.REQUEST.SELECTED_EXAMPLE
                          "
                        >
                          <pre><code>{{EXAMPLE.VALUE | json}}</code></pre>
                        </div>
                      </div>
                    </ion-col>
                    <ion-col size="6" *ngIf="ENDPOINT.RESPONSE.JSON">
                      <ion-item>
                        <ion-select
                          label="Example Response"
                          placeholder="Select example Response..."
                          [(ngModel)]="ENDPOINT.RESPONSE.SELECTED_EXAMPLE"
                          interface="popover"
                        >
                          <ion-select-option
                            *ngFor="let example of ENDPOINT.RESPONSE.EXAMPLES"
                            [value]="EXAMPLE.KEY"
                          >
                            {{ EXAMPLE.KEY }}
                          </ion-select-option>
                        </ion-select>
                      </ion-item>
                      <div *ngFor="let example of ENDPOINT.RESPONSE.EXAMPLES">
                        <div
                          *ngIf="
                            EXAMPLE.KEY === ENDPOINT.RESPONSE.SELECTED_EXAMPLE
                          "
                        >
                          <pre><code>{{EXAMPLE.VALUE | json}}</code></pre>
                        </div>
                      </div>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="12">
                      <ion-toolbar>
                        <ion-button
                          slot="end"
                          (click)="ENDPOINT.TRY_REQUEST = !ENDPOINT.TRY_REQUEST"
                          >Try now!</ion-button
                        >
                      </ion-toolbar>
                    </ion-col>
                  </ion-row>
                  <div *ngIf="ENDPOINT.TRY_REQUEST">
                    <ion-label> Request </ion-label>
                    <ion-row>
                      <ion-col size="6">
                        <ion-segment [(ngModel)]="ENDPOINT.REQUEST_METHOD">
                          <ion-segment-button value="raw">
                            <ion-label>Raw</ion-label>
                          </ion-segment-button>
                          <ion-segment-button value="form">
                            <ion-label>Form</ion-label>
                          </ion-segment-button>
                        </ion-segment>
                      </ion-col>
                    </ion-row>
                    <ion-row [ngSwitch]="ENDPOINT.REQUEST_METHOD">
                      <ion-col>
                        <div *ngSwitchCase="'raw'">
                          <ion-item>
                            <ion-textarea
                              label="Request"
                              auto-grow="true"
                              type="text"
                              [(ngModel)]="ENDPOINT.MODEL_RAW"
                            ></ion-textarea>
                          </ion-item>
                        </div>
                        <div *ngSwitchCase="'form'">Form</div>
                      </ion-col>
                    </ion-row>
                    <ion-row>
                      <ion-col size="12">
                        <ion-toolbar>
                          <ion-button
                            slot="end"
                            (click)="request(endpoint)"
                            [disabled]="ENDPOINT.FETCH?.loading"
                          >
                            Run!
                          </ion-button>
                        </ion-toolbar>
                      </ion-col>
                    </ion-row>
                    <ion-label> Response </ion-label>
                    <ion-row>
                      <ion-col size="12">
                        <ngx-spinner [name]="ENDPOINT.METHOD"></ngx-spinner>
                        <pre><code>{{ENDPOINT.FETCH?.response}}</code></pre>
                      </ion-col>
                    </ion-row>
                  </div>
                </ion-grid>
              </ion-card-content>
            </ion-accordion>
          </ion-accordion-group>
          <!-- </ion-card> -->
        </ng-container>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
