<ion-app>
  <app-header></app-header>
  <ion-content>
    <ng-container *ngIf="NAVIGATION_SERVICE.POSITION() === 'disabled'">
      <ng-template *ngTemplateOutlet="sidemenu">
      </ng-template>
      <ion-content>
        <ng-template *ngTemplateOutlet="content">
        </ng-template>
      </ion-content>
    </ng-container>
    <ion-split-pane style="--side-max-width: 10%;" when="xs" contentId="main"
      *ngIf="NAVIGATION_SERVICE.POSITION() === 'left'">
      <ng-container *ngTemplateOutlet="sidemenu">
      </ng-container>

      <div id="main">
        <ng-template *ngTemplateOutlet="content"></ng-template>
      </div>
    </ion-split-pane>

    <ng-container *ngIf="NAVIGATION_SERVICE.POSITION() === 'bottom'">
      <ng-container *ngTemplateOutlet="content">
      </ng-container>
      <ng-container *ngTemplateOutlet="sidemenu">
      </ng-container>
    </ng-container>
  </ion-content>

  <oe-navigation></oe-navigation>
  <ng-container *ngTemplateOutlet="footer"></ng-container>
</ion-app>

<ng-template #content>
  <ng-container *ngIf="WEBSOCKET.STATUS === 'connecting' || WEBSOCKET.STATUS === 'failed'">
    <ion-grid>
      <ion-row class="ion-justify-content-center">
        <ion-col size="12" size-md="6">
          <ion-card [ngSwitch]="WEBSOCKET.STATUS">

            <!-- Trying to connect to backend -->
            <ion-item color="light" *ngSwitchCase="'connecting'">
              <ion-icon slot="start" name="wifi-outline"></ion-icon>
              <ion-label class="ion-text-wrap">
                <h2 translate>INDEX.CONNECTION_IN_PROGRESS</h2>
              </ion-label>
            </ion-item>

            <!-- Connection failed -->
            <ion-item color="light" *ngSwitchCase="'failed'">
              <ion-icon slot="start" name="close-circle-outline"></ion-icon>
              <ion-label class="ion-text-wrap">
                <h2 translate [translateParams]="{value: 'OpenEMS'}">INDEX.CONNECTION_FAILED</h2>
                <p color="light">{{ ENVIRONMENT.URL }}</p>
              </ion-label>
            </ion-item>

          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-container>

  <systemLog *ngIf="isSystemLogEnabled"></systemLog>

  <!-- Show Sub-Views -->
  <ion-router-outlet id="content"></ion-router-outlet>
</ng-template>

<ng-template #sidemenu>
  <ion-menu menuId="main-menu" [contentId]="NAVIGATION_SERVICE.POSITION === 'left' ? 'main': 'content'"
    [type]="NAVIGATION_SERVICE.POSITION === 'left' ? '': 'overlay'" side="start">
    <ion-list>
      <ion-item *ngIf="(SERVICE.METADATA | async)?.user as user" routerLinkActive="active"
        (click)="NAV_CTRL.NAVIGATE_ROOT('/user');MENU.CLOSE()">
        <ion-icon style="margin-right: 5%" size="large" color="primary" slot="start" name="person-outline">
        </ion-icon>
        <ion-label>
          <p style="color:var(--ion-text-color);">{{ USER.NAME }}</p>
          <ion-text>
            <p style="color:var(--ion-text-color-shade);">{{ USER.ID }}</p>
          </ion-text>
        </ion-label>
      </ion-item>

      <!-- Show Link to Overview if more than one Edge is accessible or the globalRole is at least installer -->
      <ng-container *ngIf="(SERVICE.METADATA | async) as service">
        <ng-container *ngIf="isUserAllowedToSeeOverview">
          <ion-item lines="full" routerLinkActive="active" routerLink="/overview" (click)="MENU.CLOSE()">
            <ion-label translate>MENU.OVERVIEW </ion-label>
          </ion-item>
        </ng-container>
      </ng-container>

      <nav *ngIf="SERVICE.CURRENT_EDGE() as edge">
        <ion-item lines="inset" routerLink="/device/{{ EDGE.ID }}/settings" (click)="MENU.CLOSE()">
          <ion-label translate>MENU.EDGE_SETTINGS</ion-label>
        </ion-item>
      </nav>

      @if(!SERVICE.IS_SMARTPHONE_RESOLUTION && NAVIGATION_SERVICE.POSITION() === "left"){
      <oe-navigation-chips (navigate)="NAVIGATION_SERVICE.NAVIGATE_TO($event)"></oe-navigation-chips>
      }
    </ion-list>
  </ion-menu>
</ng-template>

<ng-template #footer>
  <ion-footer *ngIf="isSystemOutage">
    <ion-toolbar color="warning">
      <ion-grid>
        <ion-row class="ion-justify-content-center">
          <ion-col size="12" size-md="6">
            <span translate>GENERAL.SYSTEM_OUTAGE</span>
            <span>&nbsp;</span>
            <a href="https://STATUS.FENECON.DE/" target="_blank">STATUS.FENECON.DE</a>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-toolbar>
  </ion-footer>
  <oe-footer #appFooter slot="fixed" *ngIf="isUserAllowedToSeeFooter && !isHistoryDetailView"></oe-footer>
</ng-template>
